var app=angular.module("ToyotaPOCApp",["ngRoute","edittrip","viewtrips","logtrip","locator","update-details","SQLservices"]).run(["DB",function(e){e.openDb(),e.createTables(),e.setupRecords()}]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/home.html"}).when("/viewtrips",{templateUrl:"views/viewtrips.html",controller:"ViewTripsController"}).when("/logtrip",{templateUrl:"views/logtrip.html"}).when("/logtrip/gpstracker",{templateUrl:"views/logtrip.gpstracker.html",controller:"GPSTrackerController"}).when("/logtrip/manual",{templateUrl:"views/logtrip.manual.html",controller:"LogManualController"}).when("/update/edittrip/:id",{templateUrl:"views/edittrip.html",controller:"EditTripController"}).when("/updatedetails",{templateUrl:"views/update-details.html"}).when("/update/driver",{templateUrl:"views/driver.html",controller:"DriverController"}).when("/update/editdriver/:id",{templateUrl:"views/editdriver.html",controller:"EditDriverController"}).when("/update/vehicle",{templateUrl:"views/vehicle.html",controller:"VehicleController"}).when("/update/editvehicle/:id",{templateUrl:"views/editvehicle.html",controller:"EditVehicleController"}).when("/locator",{templateUrl:"views/locator.html",controller:"LocatorController"})}]),angular.module("SQLservices",[]).factory("DB",["$q","$rootScope",function(e){var r={};return r.db=null,r.openDb=function(){r.db=void 0!==window.sqlitePlugin?window.sqlitePlugin.openDatabase({name:"ToyotaPOCDb"}):window.openDatabase("ToyotaPOCDb","1.0","database",-1)},r.createTables=function(){r.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS Vehicles (id integer primary key, vehiclerego text, created datetime)"),e.executeSql("CREATE TABLE IF NOT EXISTS Drivers (id integer primary key, firstname text, lastname text, address text, created datetime)"),e.executeSql("CREATE TABLE IF NOT EXISTS NatureOfTrip (id integer primary key, purpose text, created datetime)"),e.executeSql("CREATE TABLE IF NOT EXISTS Trips (id integer primary key, kmfrom integer, kmto integer, vehicleid integer, natureoftripid integer, driverid integer, datestart datetime, dateend datetime, locationfrom text, locationto text, created datetime, FOREIGN KEY(vehicleid) REFERENCES Vehicles(id), FOREIGN KEY(natureoftripid) REFERENCES NatureOfTrip(id), FOREIGN KEY(driverid) REFERENCES Drivers(id))")})},r.setupRecords=function(){r.db.transaction(function(e){e.executeSql("SELECT * FROM NatureOfTrip",[],function(e,t){t.rows.length<=0&&(e.executeSql("INSERT INTO NatureOfTrip (purpose, created) VALUES (?,?)",["Private Usage","2014-12-20"],function(){r.onSuccess,r.onError}),e.executeSql("INSERT INTO NatureOfTrip (purpose, created) VALUES (?,?)",["Business usage","2014-12-20"],function(){r.onSuccess,r.onError}))},r.onError),e.executeSql("SELECT * FROM Drivers",[],function(e,t){t.rows.length<=0&&(e.executeSql("INSERT INTO Drivers (firstname, lastname, address, created) VALUES (?,?,?,?)",["Yann","Randri","Oakton CLarence Street","2014-12-20"],function(){r.onSuccess,r.onError}),e.executeSql("INSERT INTO Drivers (firstname, lastname, address, created) VALUES (?,?,?,?)",["Jason","Woods","Oakton CLarence Street","2014-12-20"],function(){r.onSuccess,r.onError}),e.executeSql("INSERT INTO Drivers (firstname, lastname, address, created) VALUES (?,?,?,?)",["Sergei","Mishkarudny","Oakton CLarence Street","2014-12-20"],function(){r.onSuccess,r.onError}),e.executeSql("INSERT INTO Drivers (firstname, lastname, address, created) VALUES (?,?,?,?)",["Aiden","Zadeh","Oakton CLarence Street","2014-12-20"],function(){r.onSuccess,r.onError}))},r.onError),e.executeSql("SELECT * FROM Vehicles",[],function(e,t){t.rows.length<=0&&(e.executeSql("INSERT INTO Vehicles (vehiclerego, created) VALUES (?,?)",["AL33LL","2014-12-20"],function(){r.onSuccess,r.onError}),e.executeSql("INSERT INTO Vehicles (vehiclerego, created) VALUES (?,?)",["BD89GG","2014-12-20"],function(){r.onSuccess,r.onError}))},r.onError)})},r.fetchAll=function(e){var r=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)r.push(e.rows.item(t));return r},r.fetch=function(e){return e.rows.item(0)},r.onSuccess=function(){console.log("SQLite query was successful!")},r.onError=function(e,r){console.log("SQLite Error: "+r.message)},r.query=function(t,n){n="undefined"!=typeof n?n:[];var o=e.defer();return r.db.transaction(function(e){e.executeSql(t,n,function(e,r){o.resolve(r)},function(e,r){o.reject(r)})}),o.promise},r}]).factory("NatureOfTrip",["DB",function(e){var r=this;return r.all=function(){return e.query("SELECT * FROM NatureOfTrip").then(function(r){return e.fetchAll(r)})},r.getById=function(r){return e.query("SELECT * FROM NatureOfTrip WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r}]).factory("Vehicles",["DB",function(e){var r=this;return r.all=function(){return e.query("SELECT * FROM Vehicles").then(function(r){return e.fetchAll(r)})},r.getById=function(r){return e.query("SELECT * FROM vehicles WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.remove=function(r){return e.query("DELETE FROM vehicles WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.add=function(r){return e.query("INSERT INTO Vehicles (vehiclerego, created) VALUES (?,?)",[r,(new Date).getTime()]).then(function(r){return e.fetch(r)})},r.update=function(r,t){return e.query("UPDATE Vehicles SET vehiclerego=? WHERE id=?",[t,r])},r}]).factory("Drivers",["DB",function(e){var r=this;return r.all=function(){return e.query("SELECT * FROM Drivers").then(function(r){return e.fetchAll(r)})},r.getById=function(r){return e.query("SELECT * FROM Drivers WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.remove=function(r){return e.query("DELETE FROM Drivers WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.add=function(r,t,n){return e.query("INSERT INTO Drivers (firstname, lastname, address, created) VALUES (?,?,?,?)",[r,t,n,(new Date).getTime()]).then(function(r){return e.fetch(r)})},r.update=function(r,t,n,o){return e.query("UPDATE Drivers SET firstname=?, lastname=?, address=? WHERE id=?",[t,n,o,r])},r}]).factory("Trips",["DB",function(e){var r=this;return r.all=function(){return e.query("SELECT * FROM Trips").then(function(r){return e.fetchAll(r)})},r.getById=function(r){return e.query("SELECT * FROM Trips WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.remove=function(r){return e.query("DELETE FROM Trips WHERE id = ?",[r]).then(function(r){return e.fetch(r)})},r.add=function(r,t,n,o,i,l,a,c,u){return e.query("INSERT INTO Trips (kmfrom, kmto, vehicleid, natureoftripid, driverid, datestart, dateend, locationfrom, locationto, created) VALUES (?,?,?,?,?,?,?,?,?,?)",[r,t,n,o,i,l,a,c,u,(new Date).getTime()]).then(function(r){return e.fetch(r)})},r.update=function(r,t,n,o,i,l,a,c,u,s){return e.query("UPDATE Trips SET kmfrom=?, kmto=?, vehicleid=?, natureoftripid=?, driverid=?, datestart=?, dateend=?, locationfrom=?, locationto=? WHERE id=?",[t,n,o,i,l,a,c,u,s,r])},r}]);var locatorControllers=angular.module("locator.controllers",[]);locatorControllers.controller("locatorCtrl",["$scope",function(){}]),angular.module("locator",["locator.controllers"]),angular.module("logtrip",["logtrip.manual","logtrip.gpstracker"]),angular.module("update-details",["driver","vehicle"]);var viewtripsControllers=angular.module("viewtrips.controllers",["SQLservices"]);viewtripsControllers.controller("ViewTripsController",["$q","$scope","Trips",function(e,r,t){r.loadData=function(){t.all().then(function(e){r.entries=e})},r.removeTrip=function(e){t.remove(e),r.loadData()},r.loadData()}]),angular.module("viewtrips",["viewtrips.controllers"]);var gpsTrackerControllers=angular.module("logtrip.gpstracker.controllers",[]);gpsTrackerControllers.controller("GPSTrackerController",["$scope",function(){}]),angular.module("logtrip.gpstracker",["logtrip.gpstracker.controllers"]);var logManualControllers=angular.module("logtrip.manual.controllers",["SQLservices"]);logManualControllers.controller("LogManualController",["$q","$scope","$routeParams","$location","Trips","Vehicles","Drivers","NatureOfTrip",function(e,r,t,n,o,i,l,a){r.loadVehicles=function(){i.all().then(function(e){r.allvehicles=e})},r.loadDrivers=function(){l.all().then(function(e){r.alldrivers=e})},r.loadNatureOfTrips=function(){a.all().then(function(e){r.allnatureoftrips=e})},r.addTrip=function(e,t,i,l,a,c,u,s,d){o.add(e,t,i,l,a,c,u,s,d),n.url("/viewtrips"),r.loadVehicles(),r.loadDrivers(),r.loadNatureOfTrips()},r.loadVehicles(),r.loadDrivers(),r.loadNatureOfTrips()}]),angular.module("logtrip.manual",["logtrip.manual.controllers"]);var driverControllers=angular.module("driver.controllers",["SQLservices"]);driverControllers.controller("DriverController",["$q","$scope","Drivers",function(e,r,t){r.loadData=function(){t.all().then(function(e){r.entries=e})},r.addDriver=function(e,n,o){t.add(e,n,o),r.loadData()},r.removeDriver=function(e){t.remove(e),r.loadData()},r.loadData()}]),driverControllers.controller("EditDriverController",["$q","$scope","$routeParams","$location","Drivers",function(e,r,t,n,o){r.loadData=function(){var e=t.id;o.getById(e).then(function(e){r.entry=e,r.firstname=e.firstname,r.lastname=e.lastname,r.address=e.address})},r.updateDriver=function(e,r,t,i){o.update(e,r,t,i),n.url("/update/driver")},r.loadData()}]),angular.module("driver",["driver.controllers"]);var vehicleControllers=angular.module("vehicle.controllers",["SQLservices"]);vehicleControllers.controller("VehicleController",["$q","$scope","Vehicles",function(e,r,t){r.loadData=function(){t.all().then(function(e){r.entries=e})},r.addVehicle=function(e){t.add(e),r.loadData()},r.removeVehicle=function(e){t.remove(e),r.loadData()},r.loadData()}]),vehicleControllers.controller("EditVehicleController",["$q","$scope","$routeParams","$location","Vehicles",function(e,r,t,n,o){r.loadData=function(){var e=t.id;o.getById(e).then(function(e){r.entry=e,r.vehiclerego=e.vehiclerego})},r.updateVehicle=function(e,r){o.update(e,r),n.url("/update/vehicle")},r.loadData()}]),angular.module("vehicle",["vehicle.controllers"]);var edittripControllers=angular.module("edittrip.controllers",["SQLservices"]);edittripControllers.controller("EditTripController",["$q","$scope","$routeParams","$location","Trips","Vehicles","Drivers","NatureOfTrip",function(e,r,t,n,o,i,l,a){r.loadVehicles=function(){i.all().then(function(e){r.allvehicles=e})},r.loadDrivers=function(){l.all().then(function(e){r.alldrivers=e})},r.loadNatureOfTrips=function(){a.all().then(function(e){r.allnatureoftrips=e})},r.loadTrip=function(){var e=t.id;o.getById(e).then(function(e){r.entry=e,r.kmfrom=e.kmfrom,r.kmto=e.kmto,r.vehicleid=e.vehicleid,r.natureoftripid=e.natureoftripid,r.driverid=e.driverid,r.datestart=e.datestart,r.dateend=e.dateend,r.locationfrom=e.locationfrom,r.locationto=e.locationto})},r.updateTrip=function(e,r,t,i,l,a,c,u,s,d){o.update(e,r,t,i,l,a,c,u,s,d),n.url("/viewtrips")},r.loadVehicles(),r.loadDrivers(),r.loadNatureOfTrips(),r.loadTrip()}]),angular.module("edittrip",["edittrip.controllers"]);