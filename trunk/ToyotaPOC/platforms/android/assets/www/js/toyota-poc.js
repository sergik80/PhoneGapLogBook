"use strict";var app=angular.module("ToyotaPOCApp",["ngRoute","settings","phonegap","viewtrips","logtrip","locator","update-details"]);app.config(["$routeProvider",function(o){o.when("/",{templateUrl:"views/home.html"}).when("/viewtrips",{templateUrl:"views/viewtrips.html",controller:"ViewTripsController"}).when("/logtrip",{templateUrl:"views/logtrip.html"}).when("/logtrip/gpstracker",{templateUrl:"views/logtrip.gpstracker.html",controller:"GPSTrackerController"}).when("/logtrip/manual",{templateUrl:"views/logtrip.manual.html",controller:"LogManualController"}).when("/updatedetails",{templateUrl:"views/update-details.html"}).when("/update/driver",{templateUrl:"views/driver.html",controller:"DriverController"}).when("/update/vehicle",{templateUrl:"views/vehicle.html",controller:"VehicleController"}).when("/locator",{templateUrl:"views/locator.html",controller:"LocatorController"})}]),app.run(["$rootScope","AppSettings","NetworkService","NotificationService",function(o,e,t,r){t.startMonitoring(),o.$on(e.OnNetworkStatusChange,function(e,t){o.NetworkReady=t,t||r.alert("Lost Network!","Network","Ok")})}]),angular.module("settings",[]).constant("AppSettings",{network_watch_interval:1e3,gps_error_threshold:5,map_zoom:12,OnNetworkStatusChange:"event::OnNetworkStatusChange"});var locatorControllers=angular.module("locator.controllers",[]);locatorControllers.controller("locatorCtrl",["$scope",function(){}]),angular.module("locator",["locator.controllers"]),angular.module("logtrip",["logtrip.manual","logtrip.gpstracker"]),angular.module("update-details",["driver","vehicle"]);var viewtripsControllers=angular.module("viewtrips.controllers",[]);viewtripsControllers.controller("ViewTripsController",["$scope",function(){}]),angular.module("viewtrips",["viewtrips.controllers"]),angular.module("phonegap.geolocation",[]).factory("GeolocationService",["$rootScope","$log",function(o,e){var t=this;return t.watchId=null,t.trackingData=[],t.checkGeolocationAvailability=function(){return e.debug("cordovaGeolocationService.checkGeolocationAvailability."),navigator.geolocation?!0:(e.warn("Geolocation API is not available."),!1)},t.positionMoved=function(o){if(0==t.trackingData.length)return!0;var e=t.trackingData[t.trackingData.length-1];return!(o.coords.latitude==e.coords.latitude&&o.coords.longitude==e.coords.longitude)},{getCurrentPosition:function(r,n,a){e.debug("cordovaGeolocationService.getCurrentPosition.");var a=angular.extend({},{enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0},a);t.checkGeolocationAvailability()&&navigator.geolocation.getCurrentPosition(function(e){r&&"function"==typeof r&&o.$apply(r(e))},function(e){n&&"function"==typeof n&&o.$apply(n(e))},a)},watchPosition:function(r,n,a){e.debug("cordovaGeolocationService.watchPosition."),t.trackingData=[];var a=angular.extend({},{enableHighAccuracy:!0,frequency:3e3},a);t.checkGeolocationAvailability()&&(t.watchId=navigator.geolocation.watchPosition(function(e){r&&"function"==typeof r&&t.positionMoved(e)&&(t.trackingData.push(e),o.$apply(r(e)))},function(e){n&&"function"==typeof n&&o.$apply(n(e))},a))},clearWatch:function(){return e.debug("cordovaGeolocationService.clearWatch."),t.checkGeolocationAvailability()&&t.watchId?(navigator.geolocation.clearWatch(t.watchID),t.watchID=null,t.trackingData):void 0}}}]),angular.module("phonegap",["phonegap.geolocation","phonegap.notification","phonegap.network"]),angular.module("phonegap.network",[]).factory("NetworkService",["$rootScope","$log","$interval","AppSettings",function(o,e,t,r){function n(){return navigator.network?navigator.network.connection.type!=Connection.NONE:!1}function a(){i=t(function(){var e=n();e!=c&&(o.$broadcast(r.OnNetworkStatusChange,e),c=e)},1e3)}function l(){t.cancel(i),i=void 0}var i,c=!1;return o.$on("$destroy",function(){i&&l()}),{networkReady:n,startMonitoring:a,stopMonitoring:l}}]),angular.module("phonegap.notification",[]).factory("NotificationService",["$rootScope",function(o){return{alert:function(e,t,r,n){navigator.notification.alert(e,function(){n&&"function"==typeof n&&o.$apply(function(){n()})},t,r)}}}]);var gpsTrackerControllers=angular.module("logtrip.gpstracker.controllers",["phonegap","settings"]);gpsTrackerControllers.controller("GPSTrackerController",["$scope","AppSettings","uiGmapGoogleMapApi","GeolocationService","$log",function(o,e,t,r,n){function a(t){n.debug("setupMap"),o.map={tripInProgress:!1,center:{latitude:t.coords.latitude,longitude:t.coords.longitude},zoom:e.map_zoom},o.startMarker=l(t)}function l(o){return{coords:{latitude:o.coords.latitude,longitude:o.coords.longitude},options:{}}}t.then(function(){r.getCurrentPosition(a)}),o.startTrip=function(){r.getCurrentPosition(function(e){n.debug(JSON.stringify(e)),o.map.tripInProgress||(o.startMarker=l(e),o.map.tripInProgress=!0),r.watchPosition(function(e){o.lastMarker=l(e)})},function(o){n.debug(JSON.stringify(o))})},o.endTrip=function(){r.clearWatch();o.map.tripInProgress=!1},o.simulateTracking=function(){$interval(function(){o.lastMarker.coords.latitude=o.lastMarker.coords.latitude+.01},3e3)}}]),angular.module("logtrip.gpstracker",["logtrip.gpstracker.controllers","uiGmapgoogle-maps"]).config(["uiGmapGoogleMapApiProvider",function(o){o.configure({key:"AIzaSyDT51isQ2Hrr9MDwnKAKjcVvaJfc9zId8I",v:"3.17"})}]),angular.module("logtrip.gpstracker.services",["phonegap","settings"]).factory("TrackingService",["GeolocationService","NotificationService",function(o){function e(){r=[];var e={frequency:3e3,enableHighAccuracy:!0};o.watchPosition(function(o){null==n&&(n=o),a=o,r.push(o),i=0},function(){i++,i>AppSettings.gps_error_threshold},e)}function t(){return l&&(o.clearWatch(l),l=null),r}var r=[],n=null,a=null,l=null,i=0;return{getCurrentPosition:o.getCurrentPosition,startTracking:e,stopTracking:t,startPosition:n,lastPosition:a}}]);var logManualControllers=angular.module("logtrip.manual.controllers",[]);logManualControllers.controller("LogManualController",["$scope",function(){}]),angular.module("logtrip.manual",["logtrip.manual.controllers"]);var driverControllers=angular.module("driver.controllers",[]);driverControllers.controller("DriverController",["$scope",function(){}]),angular.module("driver",["driver.controllers"]);var vehicleControllers=angular.module("vehicle.controllers",[]);vehicleControllers.controller("VehicleController",["$scope","localStorageService",function(o,e){o.loadData=function(){o.entries=e.get("vehicles")},o.orderProp="serviceDate",o.selectImage=function(){navigator.camera.getPicture(function(o){document.getElementById("newVehicleImage").src=o,document.getElementById("newVehicleImageSrc").value=o},function(o){alert("Failed because: "+o),console.log("Failed because: "+o)},{quality:50,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI})},o.addVehicle=function(t,r){var n=e.get("vehicles");n||(n=[]),n.push({vehicleId:0,vehicleImg:t,vehicleName:r}),e.set("vehicles",n),o.loadData()},o.loadData()}]),vehicleControllers.controller("VehicleEntryController",["$scope","$routeParams","Vehicle",function(o,e,t){o.entry=t.get({serviceId:e.serviceId},function(e){o.mainImageUrl=e.images[0]}),o.setImage=function(e){o.mainImageUrl=e}}]),angular.module("vehicle",["vehicle.controllers"]);var edittripControllers=angular.module("edittrip.controllers",[]);edittripControllers.controller("EditTripController",["$scope",function(){}]),angular.module("edittrip",["edittrip.controllers"]);